<!DOCTYPE html>
<html>
<head>
  <title> Gastos de Movilidad </title>
  <style>
    .row {
      display: flex;
      justify-content: flex-start;
    }
    .column {
      margin: 5px;
      padding: 5px;
      border: 1px solid black;
      text-align: center;
    }
    #holidayInput {
      width: 520px;
    }
  </style>
</head>
<body>
  <span style="display: inline-block;"> 
    <img src="LogoCaba.jpg" width="40" height="40" alt="Logo de la CABA">
    <h3 style="display: inline; margin-left: 10px;"> DGR/AGIP -   REPORTE MENSUAL DE GASTOS DE MOVILIDAD   -  v. 2.O - actualizada el 05-01-2025</h3>
  </span>

  <h3>Medio de transporte utilizado: Público, desde CABA a CABA</h3>
  
  <form id="inputForm">
    <label for="department">Departamento:</label>
    <input type="text" id="department" required value = "A"><br>

    <label for="sector">División:</label>
    <input type="number" id="sector" required value = "1" ><br>

    <label for="fullName">Apellido y nombre:</label>
    <input type="text" id="fullName" required><br>

    <label for="dni">D.N.I (sin puntos):</label>
    <input type="number" id="dni" required min="1" ><br>

    <label for="travelValue">Valor del viaje (sin puntos ni decimales) : $ </label>
    <input type="number" id="travelValue" step="1" required min="1" step="1"><br>

    <label for="tripsPerDay">Cantidad de viajes por día:</label>
    <input type="number" id="tripsPerDay" required value="4"><br>

    <label for="month">Mes (1-12):</label>
    <input type="number" id="month" min="1" max="12" required><br>  
    <label for="year">Año:</label>
    <input type="number" id="year" required value="2025"><br>

    <label for="holidayInput">Días feriados, licencias, etc. (separados por comas, excluidos sábados y domingos, no permite ingresar un rango de fechas; ej. válido: 4,5,10,25):</label>
    <input type="text" id="holidayInput" required value="0"><br>

    <h3>Gastos en Taxi</h3>
    <label for="taxiDays">Detalle de cada día en el mes (separado por coma) en que se utilizó Taxi (ej.: 1,2,3):</label>
    <input type="text" id="taxiDays" placeholder="Ej.: 1,2,3" required value="0"><br>

    <label for="taxiTrips">Total de viajes en Taxi realizados en el mes:  </label>
    <input type="number" id="taxiTrips" required value="0"><br>

   <label for="taxiMotives">Destinos y motivos de los viajes en Taxi realizados:</label>
   <textarea id="taxiMotives" rows="2" cols="100" placeholder=""></textarea><br>

    <label for="taxiCost">Costo total de viajes en Taxi en el mes (ingresar importe calculado, sin puntos ni comas):   $</label>
    <input type="number" id="taxiCost" required value="0"><br>

    <button type="submit">Calcula el total de viáticos del mes</button>
  </form>

  <h3>Resumen de gastos:</h3>
  <div id="output"></div>

  

    <script>
    function getDaysInMonth(year, month) {
      return new Date(year, month + 1, 0).getDate();
    }

    function isHoliday(day, holidays) {
      return holidays.includes(day);
    }

    function isNonWorkingDay(day) {
      const weekday = new Date(day).getDay();
      return weekday === 0 || weekday === 6;   // Sunday (0) or Saturday (6)
    }

    function filterWorkingDays(year, month, holidays) {
      const workingDays = [];
      const totalDays = getDaysInMonth(year, month);

      for (let day = 1; day <= totalDays; day++) {
        const currentDate = new Date(year, month, day);

        if (!isHoliday(day, holidays) && !isNonWorkingDay(currentDate)) {
          workingDays.push(currentDate);
        }
      }

      return workingDays;
    }

    function printArrayElements(array, travelValue, tripsPerDay) {
      const outputElement = document.getElementById('output');
      const columnCount = 5; // Show 5 days per row
      for (let i = 0; i < array.length; i += columnCount) {
        const row = document.createElement('div');
        row.classList.add('row');

        for (let j = i; j < i + columnCount; j++) {
          if (j < array.length) {
            const dateCell = document.createElement('div');
            const options = { weekday: 'short', day: '2-digit', month: '2-digit', year: 'numeric' };
            dateCell.textContent = array[j].toLocaleDateString('es-ES', options) + ` : $${(travelValue * tripsPerDay).toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            dateCell.classList.add('column');
            row.appendChild(dateCell);
          }
        }

        outputElement.appendChild(row);
      }
    }

    function numberToWords(num) {
  const units = ['cero', 'uno', 'dos', 'tres', 'cuatro', 'cinco', 'seis', 'siete', 'ocho', 'nueve'];
  const teens = ['diez', 'once', 'doce', 'trece', 'catorce', 'quince', 'dieciséis', 'diecisiete', 'dieciocho', 'diecinueve'];
  const tens = ['veinte', 'treinta', 'cuarenta', 'cincuenta', 'sesenta', 'setenta', 'ochenta', 'noventa'];
  const hundreds = ['cien', 'doscientos', 'trescientos', 'cuatrocientos', 'quinientos', 'seiscientos', 'setecientos', 'ochocientos', 'novecientos'];

  if (num < 10) return units[num];
  if (num < 20) return teens[num - 10];
  if (num < 100) return tens[Math.floor(num / 10) - 2] + (num % 10 !== 0 ? ' y ' + units[num % 10] : '');
  if (num < 1000) return hundreds[Math.floor(num / 100) - 1] + (num % 100 !== 0 ? ' ' + numberToWords(num % 100) : '');
  if (num < 1000000) return numberToWords(Math.floor(num / 1000)) + ' mil' + (num % 1000 !== 0 ? ' ' + numberToWords(num % 1000) : '');
  if (num < 100000000) return numberToWords(Math.floor(num / 1000000)) + ' millones' + (num % 1000000 !== 0 ? ' ' + numberToWords(num % 1000000) : '');
  return 'Número excede el rango programado';
}


    document.getElementById('inputForm').addEventListener('submit', function (event) {
      event.preventDefault();

      const fullName = document.getElementById('fullName').value;
      const travelValue = parseFloat(document.getElementById('travelValue').value);
      const tripsPerDay = parseInt(document.getElementById('tripsPerDay').value, 10);
      const month = parseInt(document.getElementById('month').value, 10) - 1;
      const year = parseInt(document.getElementById('year').value, 10);
      const holidayInput = document.getElementById('holidayInput').value;
      const holidays = holidayInput.split(',').map(Number);

      const taxiCost = parseFloat(document.getElementById('taxiCost').value) || 0;
      const taxiTrips = parseInt(document.getElementById('taxiTrips').value, 10) || 0;

      const workingDaysArray = filterWorkingDays(year, month, holidays);

      const totalPublicTransport = workingDaysArray.length * tripsPerDay * travelValue;
      const totalExpenses = totalPublicTransport + taxiCost;

      const output = document.getElementById('output');
      output.innerHTML = `<h4>Desglose de transporte público:</h4>`;
      printArrayElements(workingDaysArray, travelValue, tripsPerDay);

      const holidayCount = holidays.filter(h => h !== 0).length;

      output.innerHTML += `
        <p>Total de días feriados, asuetos, licencias y ausencias en el mes (sin incluir sábados ni domingos):   ${holidayCount}</p>
        <p>Total de días trabajados en el mes:   ${workingDaysArray.length}</p>
        <p>Total general de gastos por Transporte Público:   $${totalPublicTransport.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>
        <p>Total de viajes en Taxi:   ${taxiTrips}</p>
        <p>Total de gastos en Taxi:   $${taxiCost.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>
        <p>Total general de gastos de movilidad del mes:   $${totalExpenses.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>
        <p>Recibí conforme el importe de $  ${totalExpenses.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ${"(Son Pesos"} ${numberToWords(totalExpenses) + " - - "})</p>
        <p>Firmado por: ${fullName}</p>
        <p>CABA, ${new Date().toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
      `;
    });
  </script>
</body>
</html>
